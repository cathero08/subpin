import{C as se,b as A,d as z,e as I,_ as re,r as i,s as T,g as ue,w as ie,u as ce,c as p,a as m,f as v,h as c,F as H,G as de,D as B,n as ve,i as M,k as K,l as U,m as $,p as P,X as fe,Y as pe}from"./index.c91cc030.js";const me={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},he=I("path",{d:"M9.17 6l2 2H20v10H4V6h5.17M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z",fill:"currentColor"},null,-1),_e=[he],ye=se({name:"FolderOutlined",render:function(a,C){return A(),z("svg",me,_e)}});const be=$(" \u7D44\u7E54\u55AE\u4F4D "),ke={class:"p-tipSize"},ge={class:"treeTitle mx-4 my-3"},xe={__name:"Dept",setup(q){const a=i([]),{api:C,cf:we,cc:Ae,_:D,formRules:j,naiveUi:F}=T(ue()),{windowInnerHeight:Y,isLoading:Ce}=T(ie()),{userNo:W}=T(ce()),X=p(()=>Y.value*.5+"px"),f=F.value.useMessage(),_=i({note:"",level:""}),E=i(!1),r=i(-1),N=i(0),J=n=>n.option.leave!=3?P(F.value.NIcon,{size:"20",component:ye,color:"#ef9910"}):P(F.value.NIcon,{size:"20",color:"#27a83c",component:fe}),Q=n=>P("div",{style:"font-size:18px; transform:translateY(1px);"},n.option.label),Z=i([{tip:"\u65B0\u589E",type:"add",fun:()=>{const n=l=>{N.value+=1;let e={label:"\u65B0\u589E",key:N.value,leave:l,dbAction:"add"};return l<3&&(e.children=[]),e},t=l=>{l.forEach(e=>{Array.isArray(e.children)&&t(e.children),e.key==r.value&&(e.leave==3?l.push(n(3)):e.leave==1?e.children.push(n(2)):e.children.push(n(3)))})};r.value==-1?y.value.push(n(1)):t(y.value),r.value!=-1&&a.value.find(l=>l==r.value)==null&&a.value.push(r.value),R()}},{tip:"\u4FEE\u6539",type:"edit",fun:()=>{r.value!=-1&&(o.value.dbAction=="edit",E.value=!E.value)}},{tip:"\u522A\u9664",type:"delete",fun:()=>{console.log(o.value),C.value.deleteGroupCode(o.value).then(n=>{n.status==204?(f.success("\u522A\u9664\u6210\u529F"),g(),V()):f.error("\u522A\u9664\u5931\u6557")})}},{tip:"\u5C55\u958B ",type:"open",fun:()=>{a.value=[];const n=t=>{t.forEach(l=>{Array.isArray(l.children)&&n(l.children),l.key&&a.value.push(l.key)})};n(y.value),R()}},{tip:"\u6536\u5408 ",type:"openOff",fun:()=>{a.value=[],R()}}]),O=i(null),ee={name:"req"},S=i([]),o=i({name:"",userNo:W.value});S.value=j.value.createFormRules(ee,o);const g=()=>{const n=["userNo"];D.value.forEach(o.value,(t,l)=>{n.find(e=>e==l)==null&&(o.value[l]="")})},x=p(()=>E.value||o.value.dbAction=="add"),le=()=>{var n;(n=O.value)==null||n.validate(t=>{t?f.error("\u9A57\u8B49\u5931\u6557"):o.value.dbAction=="add"?(_.value.levelList.split(",").forEach((l,e)=>{o.value["level"+(e+1)]=l.trim()!="undefined"?l:""}),o.value.code="1",C.value.createGroupCode(o.value).then(l=>{l.status==201?(f.success("\u65B0\u589E\u6210\u529F"),g(),V()):f.error("\u65B0\u589E\u5931\u6557")})):C.value.updateGroupCode(o.value).then(l=>{l.status==200?(f.success("\u66F4\u65B0\u6210\u529F"),g(),V()):f.error("\u66F4\u65B0\u5931\u6557")})})},ne=i([{name:p(()=>`\u5C64\u7D1A : ${_.value.note} `),option:"title",showLabel:!1},{name:"\u7D44\u5BA4 : ",option:p(()=>x.value?"radio":""),key:"flag",showText:p(()=>o.value.flag=="1"?"\u662F":"\u5426"),radioObject:[{label:"\u662F",value:"1"},{label:"\u5426",value:"0"}]},{name:"\u540D\u7A31 : ",option:p(()=>x.value?"input":""),requireMarkPlacement:"left",key:"name"},{name:"\u7C21\u7A31 : ",option:p(()=>x.value?"input":""),key:"shortName"},{name:"\u63CF\u8FF0 : ",option:p(()=>x.value?"input":""),key:"description"},{name:"\u5099\u8A3B : ",option:p(()=>x.value?"input":""),key:"memo"}]),y=i([]),te=(n,t)=>{if(E.value=!1,t.length>0){r.value=n[0],g(),t[0]&&t[0].dbAction!="add"?D.value.forEach(t[0],(e,s)=>{o.value[s]=e}):o.value.dbAction="add";const l=(e,s,u,L)=>{e.forEach(d=>{let b,w,k;L!=null?k=L+1:k=1,u!=null?w=u+","+d["level"+k]:w=d["level"+k],s!=null?b=s+" / "+d.label:b=d.label,Array.isArray(d.children)&&l(d.children,b,w,k),r.value==d.key&&(_.value={note:b,levelList:w})})};l(y.value)}else g(),_.value.note="",_.value.level="",r.value=-1},oe=n=>({onClick(t){t.path.forEach(l=>{l.localName=="span"&&l.className.indexOf("n-tree-node-switcher")!=-1&&(a.value.indexOf(n.option.key)==-1?a.value.push(n.option.key):a.value=a.value.filter(e=>e!=n.option.key))})}}),R=()=>{a.value.push("-1"),pe(()=>{a.value=a.value.filter(n=>n!="-1")})},G=(n,t)=>{n.forEach(l=>{Array.isArray(l.children)&&G(l.children,t+1),N.value+=1,l.key=N.value,l.leave=t})},V=n=>{_.value="",r.value=-1,E.value=!1,g(),C.value.queryGroupCode().then(t=>{if(t.status==200){let l=[];t.data.forEach(e=>{e.level1&&!e.level2&&!e.level3&&l.push({label:e.name,children:[],...D.value.cloneDeep(e)})}),t.data.forEach(e=>{if(e.level1&&e.level2&&!e.level3){let s=l.find(u=>u.level1==e.level1);s!=null&&s.children.push({label:e.name,children:[],...D.value.cloneDeep(e)})}}),t.data.forEach(e=>{if(e.level1&&e.level2&&e.level3){let s=l.find(u=>u.level1==e.level1).children.find(u=>u.level2==e.level2);s!=null&&s.children.push({label:e.name,...D.value.cloneDeep(e)})}}),y.value=l,G(y.value,1),R(),n&&f.success("\u67E5\u8A62\u6210\u529F")}else n&&f.error("\u67E5\u8A62\u5931\u6557")})};return V(!0),(n,t)=>{const l=m("commonTitle"),e=m("commonBtn"),s=m("n-tooltip"),u=m("n-space"),L=m("n-tree"),d=m("n-layout"),b=m("n-gi"),w=m("commonForm"),k=m("n-grid");return A(),z(H,null,[v(l,null,{default:c(()=>[be]),_:1}),v(u,{class:"mb-3"},{default:c(()=>[(A(!0),z(H,null,de(Z.value,(h,ae)=>(A(),K(s,{key:ae,trigger:"hover"},{trigger:c(()=>[v(e,{class:"mx-1 mb-1",type:h.type,onClick:h.fun},null,8,["type","onClick"])]),default:c(()=>[I("div",ke,B(h.tip),1)]),_:2},1024))),128))]),_:1}),v(k,{id:"animation",class:"mt-4",cols:12,"x-gap":0},{default:c(()=>[v(b,{span:5},{default:c(()=>[v(d,{class:"border-style","native-scrollbar":!1},{default:c(()=>[I("div",ge,"\u5C64\u7D1A : "+B(_.value.note),1),v(d,{"native-scrollbar":!1,style:ve({height:M(X)})},{default:c(()=>[v(L,{class:"px-3 ms-3","block-line":"",data:y.value,"node-props":oe,"expanded-keys":a.value,"render-prefix":J,"render-label":Q,"onUpdate:selectedKeys":te},null,8,["data","expanded-keys"])]),_:1},8,["style"])]),_:1})]),_:1}),v(b,{span:7},{default:c(()=>[r.value!=-1?(A(),K(w,{key:0,class:"px-4 pt-4",formRef:O.value,"onUpdate:formRef":t[0]||(t[0]=h=>O.value=h),formRules:S.value,formOption:ne.value,formLabelWidth:75,modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=h=>o.value=h),span:24},null,8,["formRef","formRules","formOption","modelValue"])):U("",!0),M(x)?(A(),K(u,{key:1,justify:"center"},{default:c(()=>[v(e,{type:"save",onClick:t[2]||(t[2]=h=>le())},{default:c(()=>[$(B(o.value.dbAction=="add"?"\u65B0\u589E":"\u5132\u5B58"),1)]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1})],64)}}},Ee=re(xe,[["__scopeId","data-v-e7a044f8"]]);export{Ee as default};
