import{s as A,g as xe,w as we,u as ke,c as n,r as l,E as Se,a as I,b as be,d as Re,f as o,h as i,i as D,m as C,D as te,n as B,e as Ge,F as Ne,p as T}from"./index.c91cc030.js";const _e=C(" \u7DB1\u8981\u7D93\u8CBB\u5207\u5272 "),Le=C("\u3000 \u52FE\u9078\u8F49\u5165\u6A19\u6848 "),Ee=C("\u5132\u5B58"),Be=C("\u6E05\u7A7A"),Fe={class:"px-5 my-4"},Pe=C("\u4E0A\u50B3"),Ve={__name:"PlanCostCutting",setup(Oe){const{globalFieldData:b,api:f,cf:j,cc:F,_:ae,formRules:N,naiveUi:ne,fileSaver:ue}=A(xe()),{windowInnerHeight:q,isLoading:x}=A(we()),{userNo:P}=A(ke()),z=n(()=>q.value*.68+"px"),le=n(()=>q.value*.5+"px"),u=l(""),_=l(!1),p=ne.value.useMessage(),H=l([{label:"test1",value:"1"},{label:"test2",value:"2"},{label:"test3",value:"3"}]),L=l(!1),c=Se({page:1,pageCount:1,pageSize:25,onChange:t=>{_.value=!0,d.value.currentPage=t,w(!0)}}),M=l([]),K=l(null),oe={},$=l([]),d=l({currentPage:c.page,pages:c.pageSize});$.value=N.value.createFormRules(oe,d);const re=l([{option:"btn",showLabel:!1,showFeedback:!1,style:{"margin-bottom":"0.75rem"},span:24,btnObject:[{name:"\u532F\u5165Excel",type:"excel",onClick:()=>{L.value=!0}},{name:"\u532F\u51FAExcel",type:"excel",onClick:()=>{x.value=!0,f.value.exportFile("/plancostcuttingData/exportXls",d.value).then(t=>{t.status==200?(x.value=!0,f.value.downloadExcel({fileName:t.data}).then(e=>{if(e.status==200){p.success("\u532F\u51FA\u6210\u529F");var s=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;"});ue.value.saveAs(s,"\u7DB1\u8981\u7D93\u8CBB\u5207\u5272.xlsx")}else p.error("\u532F\u51FA\u5931\u6557")})):p.error("\u532F\u51FA\u5931\u6557")})}},{name:"\u65B0\u589E\u5207\u5272\u7D93\u8CBB",type:"add",onClick:()=>{u.value="new",Q(),S.value=!0}},{name:"\u52FE\u9078\u8F49\u5165\u6A19\u6848",type:"",disabled:n(()=>v.value.length==0),onClick:()=>{R.value=!0}}]},{name:"\u5E74\u5EA6",span:3,option:"select",key:"year",filter:!0,optionsList:n(()=>b.value.yearOptions)},{name:"\u7DB1\u8981\u8A08\u756B",option:"input",key:"planName"},{name:"\u7D93\u8CBB\u7D44\u5BA4",span:10,option:"select",selectMultiple:!0,filter:!0,optionsList:n(()=>b.value.ministryCode),key:"groupCode"},{option:"btnTip",btnObject:[{name:"\u67E5\u8A62",type:"search",onClick:()=>{_.value=!0,d.value.currentPage=1,w(!0)}},{name:"\u6E05\u7A7A",type:"clear",onClick:()=>{d.value.year="",d.value.planName="",d.value.groupCode=[],c.page=1,d.value.currentPage=1}}]}]),w=t=>{f.value.queryPlanCut(d.value).then(e=>{e.status==200?(t&&p.success("\u67E5\u8A62\u6210\u529F"),M.value=e.data.lists,c.page=e.data.currentPage,c.pageCount=e.data.totalPage,c.pageRows=e.data.totalRows):t&&p.error("\u67E5\u8A62\u5931\u6557"),_.value=!1})},R=l(!1),W=l(null),se={},X=l([]),g=l({id:"",userNo:P.value});X.value=N.value.createFormRules(se,g);const v=l([]),ie=(t,e)=>{k.value=t,e.forEach(s=>{s!=null&&v.value.find(m=>s.id==m.id)==null&&v.value.push({id:s.id,name:s.name})}),v.value=v.value.filter(s=>k.value.find(m=>s.id==m)!=null)},k=l([]),Y=()=>{R.value=!1,v.value=[],k.value=[]},pe=()=>{g.value.plansubIdList=v.value.filter(t=>t.id!=g.value.id).map(t=>t.id),f.value.transferPlanCut(g.value).then(t=>{t.status==200?(p.success("\u8F49\u5165\u6210\u529F"),w(),Y()):p.error("\u8F49\u5165\u5931\u6557")})},me=l([{name:"\u8ACB\u9078\u64C7\u4E3B\u8981\u7DB1\u8981\u8A08\u756B\uFF1A",option:"title",showLabel:!1},{option:"radio",key:"id",showLabel:!1,radioObject:n(()=>v.value.map(t=>({value:t.id,label:t.name,style:{width:"80%","margin-bottom":"15px"},suffixRender:()=>T(F.value.commonBtn,{style:"transform: translateY(4px);",type:"cancel",size:"tiny",onClick:()=>{k.value=k.value.filter(e=>e!=t.id),v.value=v.value.filter(e=>e.id!=t.id),t.id==g.value.id&&(g.value.id=""),v.value.length==0&&(R.value=!1)}})})))}]),S=l(!1),O=l(null),de={year:"req",groupCode:"req",name:"req"},J=l([]),a=l({year:"",groupCode:"",name:"",userNo:P.value});J.value=N.value.createFormRules(de,a);const y=t=>n(()=>{let e=0;return t.forEach(m=>{isNaN(Number(a.value[m]))||(e+=Number(a.value[m]))}),e});a.value.bsum=y(["approveAgentCurrent","approveAgentB2current","approveAgentCapital"]),a.value.csum=y(["approveGrantCurrent","approveGrantCurrentc2current","approveGrantCapital"]),a.value.esum=y(["approveGrantFirm","approveGrantGroup","approveGrantStudent","approveGrantBonus","approveGrantNongroup","approveGrantIndividual"]),a.value.approveSum=y(["bsum","csum","approveOperatingExpense"]),a.value.legalBsum=y(["legalAgentCurrent","legalAgentB2current","legalAgentCapital"]),a.value.legalCsum=y(["legalGrantCurrent","legalGrantCurrentc2current","legalGrantCapital"]),a.value.legalEsum=y(["legalGrantFirm","legalGrantGroup","legalGrantStudent","legalGrantBonus","legalGrantNongroup","legalGrantIndividual"]),a.value.legalSum=y(["legalBsum","legalCsum","legalOperatingExpense"]);const Q=()=>{const t=["approveSum","esum","csum","bsum","legalSum","legalBsum","legalCsum","legalEsum","userNo"];j.value.objectInt(a.value,t)},ve=()=>{var t;(t=O.value)==null||t.validate(e=>{e?p.error("\u9A57\u8B49\u5931\u6557"):(x.value=!0,u.value=="new"?f.value.createPlanCut(a.value).then(s=>{s.status==201?(p.success("\u65B0\u589E\u6210\u529F"),w(),S.value=!1):p.error("\u65B0\u589E\u5931\u6557")}):f.value.updatePlanCut(a.value).then(s=>{s.status==200?(p.success("\u66F4\u65B0\u6210\u529F"),w(),S.value=!1):p.error("\u66F4\u65B0\u5931\u6557")}))})};l(!1);const fe=l([{showLabel:!1,name:"\u7D93\u8CBB\u5207\u5272\u57FA\u672C\u8CC7\u6599",option:"title"},{name:"\u5E74\u5EA6 :",option:"select",key:"year",filter:!0,optionsList:n(()=>b.value.yearOptions)},{name:"\u7D44\u5BA4 :",option:"select",key:"groupCode",filter:!0,optionsList:n(()=>b.value.ministryCode)},{name:"\u7D93\u8CBB\u5207\u5272\u540D\u7A31 :",option:"input",key:"name"},{name:"\u7DB1\u8981\u8A08\u756B :",option:"select",key:"planId",optionsList:H},{name:"\u63A1\u8CFC\u65B9\u5F0F :",option:"select",key:"valuationCode",optionsList:H},{name:"memo :",option:"textarea",key:"memo"},{showLabel:!1,name:"\u884C\u653F\u9662\u6838\u5B9A\u6578 :",option:"title"},{name:"\u7D93\u8CBB\u6982\u7B97\u6578(B+C+D) :",option:"numInput",numInputReadonly:!0,numInputSuffix:"(\u4EDF\u5143)",key:"approveSum"},{showLabel:!1,name:"\u59D4\u8FA6\u8CBB(B)",option:"title"},{name:"\u7D93\u5E38\u9580 :",option:"numInput",key:"approveAgentCurrent",numInputSuffix:"(\u4EDF\u5143)"},{name:"B2\u7D93\u5E38\u9580(\u589E\u5321) :",option:"numInput",key:"approveAgentB2current",numInputSuffix:"(\u4EDF\u5143)"},{name:"\u8CC7\u672C\u9580 :",option:"numInput",key:"approveAgentCapital",numInputSuffix:"(\u4EDF\u5143)"},{name:"\u5408\u8A08 :",option:"numInput",numInputReadonly:!0,numInputSuffix:"(\u4EDF\u5143)",key:"bsum"},{showLabel:!1,name:"\u734E\u88DC\u52A9\u8CBB(C)",option:"title"},{name:"\u7D93\u5E38\u9580 :",option:"numInput",key:"approveGrantCurrent",numInputSuffix:"(\u4EDF\u5143)"},{name:"C2\u7D93\u5E38\u9580(\u589E\u6846)",option:"numInput",key:"approveGrantCurrentc2current",numInputSuffix:"(\u4EDF\u5143)"},{name:"\u8CC7\u672C\u9580 :",option:"numInput",key:"approveGrantCapital",numInputSuffix:"(\u4EDF\u5143)"},{name:"\u5408\u8A08 :",option:"numInput",numInputReadonly:!0,numInputSuffix:"(\u4EDF\u5143)",key:"csum"},{showLabel:!1,name:"\u696D\u52D9\u8CBB(D) :",option:"title"},{name:" ",option:"numInput",key:"approveOperatingExpense",numInputSuffix:"(\u4EDF\u5143)"},{showLabel:!1,name:"\u734E\u88DC\u52A9\u8CBB\u660E\u7D30(E)",option:"title"},{name:"\u5C0D\u4F01\u696D\u6350\u52A9 :",option:"numInput",key:"approveGrantFirm",numInputSuffix:"(\u4EDF\u5143)"},{name:"\u5C0D\u5718\u9AD4\u6350\u52A9 :",option:"numInput",key:"approveGrantGroup",numInputSuffix:"(\u4EDF\u5143)"},{name:"\u5C0D\u5B78\u751F\u4E4B\u734E\u52A9 :",option:"numInput",key:"approveGrantStudent",numInputSuffix:"(\u4EDF\u5143)"},{name:"\u734E\u52F5\u91D1(\u5C0D\u5718\u9AD4-\u4F01\u696D) :",option:"numInput",key:"approveGrantBonus",numInputSuffix:"(\u4EDF\u5143)"},{name:"\u734E\u52F5\u91D1(\u5C0D\u5718\u9AD4-\u975E\u4F01\u696D) :",option:"numInput",key:"approveGrantNongroup",numInputSuffix:"(\u4EDF\u5143)"},{name:"\u734E\u52F5\u91D1(\u5C0D\u500B\u4EBA) :",option:"numInput",key:"approveGrantIndividual",numInputSuffix:"(\u4EDF\u5143)"},{name:"\u5408\u8A08(C=E) :",option:"numInput",numInputReadonly:!0,numInputSuffix:"(\u4EDF\u5143)",validationStatus:n(()=>!isNaN(a.value.esum)&&!isNaN(a.value.csum)&&a.value.esum!=a.value.csum?"warning":"success"),feedback:n(()=>!isNaN(a.value.esum)&&!isNaN(a.value.csum)&&a.value.esum!=a.value.csum?`C \u9700\u7B49\u65BC E\u3002 C = ${a.value.csum.toLocaleString("en-US")} (\u4EDF\u5143)`:""),key:"esum"},{show:n(()=>u.value=="edit"),showLabel:!1,name:"\u7ACB\u6CD5\u9662\u6838\u5B9A\u6578 :",option:"title"},{show:n(()=>u.value=="edit"),name:"\u7D93\u8CBB\u6982\u7B97\u6578(B+C+D) :",option:"numInput",numInputReadonly:!0,numInputSuffix:"(\u4EDF\u5143)",key:"legalSum"},{show:n(()=>u.value=="edit"),showLabel:!1,name:"\u59D4\u8FA6\u8CBB(B)",option:"title"},{show:n(()=>u.value=="edit"),name:"\u7D93\u5E38\u9580 :",option:"numInput",key:"legalAgentCurrent",numInputSuffix:"(\u4EDF\u5143)"},{show:n(()=>u.value=="edit"),name:"B2\u7D93\u5E38\u9580(\u589E\u5321) :",option:"numInput",key:"legalAgentB2current",numInputSuffix:"(\u4EDF\u5143)"},{show:n(()=>u.value=="edit"),name:"\u8CC7\u672C\u9580 :",option:"numInput",key:"legalAgentCapital",numInputSuffix:"(\u4EDF\u5143)"},{show:n(()=>u.value=="edit"),name:"\u5408\u8A08 :",option:"numInput",numInputReadonly:!0,numInputSuffix:"(\u4EDF\u5143)",key:"legalBsum"},{show:n(()=>u.value=="edit"),showLabel:!1,name:"\u734E\u88DC\u52A9\u8CBB(C)",option:"title"},{show:n(()=>u.value=="edit"),name:"\u7D93\u5E38\u9580 :",option:"numInput",key:"legalGrantCurrent",numInputSuffix:"(\u4EDF\u5143)"},{show:n(()=>u.value=="edit"),name:"C2\u7D93\u5E38\u9580(\u589E\u6846)",option:"numInput",key:"legalGrantCurrentc2current",numInputSuffix:"(\u4EDF\u5143)"},{show:n(()=>u.value=="edit"),name:"\u8CC7\u672C\u9580 :",option:"numInput",key:"legalGrantCapital",numInputSuffix:"(\u4EDF\u5143)"},{show:n(()=>u.value=="edit"),name:"\u5408\u8A08 :",option:"numInput",numInputReadonly:!0,numInputSuffix:"(\u4EDF\u5143)",key:"legalCsum"},{show:n(()=>u.value=="edit"),showLabel:!1,name:"\u696D\u52D9\u8CBB(D) :",option:"title"},{show:n(()=>u.value=="edit"),name:" ",option:"numInput",key:"legalOperatingExpense",numInputSuffix:"(\u4EDF\u5143)"},{show:n(()=>u.value=="edit"),showLabel:!1,name:"\u734E\u88DC\u52A9\u8CBB\u660E\u7D30(E)",option:"title"},{show:n(()=>u.value=="edit"),name:"\u5C0D\u4F01\u696D\u6350\u52A9 :",option:"numInput",key:"legalGrantFirm",numInputSuffix:"(\u4EDF\u5143)"},{show:n(()=>u.value=="edit"),name:"\u5C0D\u5718\u9AD4\u6350\u52A9 :",option:"numInput",key:"legalGrantGroup",numInputSuffix:"(\u4EDF\u5143)"},{show:n(()=>u.value=="edit"),name:"\u5C0D\u5B78\u751F\u4E4B\u734E\u52A9 :",option:"numInput",key:"legalGrantStudent",numInputSuffix:"(\u4EDF\u5143)"},{show:n(()=>u.value=="edit"),name:"\u734E\u52F5\u91D1(\u5C0D\u5718\u9AD4-\u4F01\u696D) :",option:"numInput",key:"legalGrantBonus",numInputSuffix:"(\u4EDF\u5143)"},{show:n(()=>u.value=="edit"),name:"\u734E\u52F5\u91D1(\u5C0D\u5718\u9AD4-\u975E\u4F01\u696D) :",option:"numInput",key:"legalGrantNongroup",numInputSuffix:"(\u4EDF\u5143)"},{show:n(()=>u.value=="edit"),name:"\u734E\u52F5\u91D1(\u5C0D\u500B\u4EBA) :",option:"numInput",key:"legalGrantIndividual",numInputSuffix:"(\u4EDF\u5143)"},{show:n(()=>u.value=="edit"),name:"\u5408\u8A08(C=E) :",option:"numInput",numInputReadonly:!0,numInputSuffix:"(\u4EDF\u5143)",validationStatus:n(()=>!isNaN(a.value.legalEsum)&&!isNaN(a.value.legalCsum)&&a.value.legalEsum!=a.value.legalCsum?"warning":"success"),feedback:n(()=>!isNaN(a.value.legalEsum)&&!isNaN(a.value.legalCsum)&&a.value.legalEsum!=a.value.legalCsum?`C \u9700\u7B49\u65BC E\u3002 C = ${a.value.legalCsum.toLocaleString("en-US")} (\u4EDF\u5143)`:""),key:"legalEsum"}]),U=l({}),ce={uploadFile:"req"},Z=l([]),G=l({uploadFile:[]});Z.value=N.value.createFormRules(ce,G);const ge=l([{name:"\u4E0A\u50B3\u6A94\u6848",option:"upload",key:"uploadFile",inputFileType:["xlsx"]}]),ye=()=>{var t;(t=U.value)==null||t.validate(e=>{e||(x.value=!0,f.value.uploadExcel(G.value.uploadFile[0],"/plancostcuttingData/upload",{userNo:P.value}).then(s=>{s.status==200?(p.success("\u4E0A\u50B3\u6210\u529F"),G.value.uploadFile=[],L.value=!1):p.error("\u4E0A\u50B3\u5931\u6557")}))})},he=t=>t.id,Ie=[{key:"id",width:"6%",title:"No",render:(t,e)=>`${e+1+(c.page-1)*c.pageSize}`},{type:"selection"},{key:"year",width:"8%",title:"\u5E74\u5EA6"},{key:"planName",title:"\u7DB1\u8981\u8A08\u756B"},{key:"name",title:"\u5207\u5272\u540D\u7A31"},{key:"groupCode",width:"10%",title:"\u7D93\u8CBB\u7D44\u5BA4",render(t){return j.value.getCodeData(b.value,"ministryCode",t.groupCode).label}},{key:"approveSum",width:"16%",title:"\u884C\u653F\u9662\u6838\u5B9A\u6578(\u4EDF\u5143)",render(t){let e=Number(t.approveSum);return isNaN(e)?0:e.toLocaleString("en-US")}},{key:"actions",width:"19%",title:"\u4F5C\u696D",render(t){return[T(F.value.commonBtn,{style:{marginRight:"8px"},type:"edit",onClick:()=>{x.value=!0,f.value.getPlanCut({id:t.id}).then(e=>{e.status==200?(p.success("\u67E5\u8A62\u6210\u529F"),u.value="edit",Q(),S.value=!0,ae.value.forEach(e.data[0],(s,m)=>{m!="approveSum"&&m!="legalSum"&&(a.value[m]=s)})):p.error("\u67E5\u8A62\u5931\u6557")})}},"\u4FEE\u6539"),T(F.value.commonBtn,{type:"delete",popClick:()=>{x.value=!0,f.value.deletePlanCut({id:t.id}).then(e=>{e.status==204?(p.success("\u522A\u9664\u6210\u529F"),w()):p.error("\u522A\u9664\u5931\u6557")})}},"\u522A\u9664")]}}];return(t,e)=>{const s=I("commonTitle"),m=I("commonForm"),Ce=I("n-data-table"),h=I("n-space"),ee=I("n-layout"),E=I("commonBtn"),V=I("n-modal");return be(),Re(Ne,null,[o(s,null,{default:i(()=>[_e]),_:1}),o(m,{class:"mt-2",formRef:K.value,"onUpdate:formRef":e[0]||(e[0]=r=>K.value=r),formRules:$.value,formOption:re.value,formLabelPlacement:"top",xGap:16,modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=r=>d.value=r),span:4},null,8,["formRef","formRules","formOption","modelValue"]),o(Ce,{remote:"","single-line":!1,columns:Ie,loading:_.value,"onUpdate:checkedRowKeys":ie,"checked-row-keys":k.value,data:M.value,"row-key":he,pagination:c,"max-height":D(le),"paginate-single-page":!1},null,8,["loading","checked-row-keys","data","pagination","max-height"]),o(V,{show:S.value,"onUpdate:show":e[4]||(e[4]=r=>S.value=r),preset:"card",class:"p-modal-body p-border",style:B({height:t.cardHeight})},{header:i(()=>[o(h,{class:"p-cardTitle"},{default:i(()=>[C("\u3000 "+te(u.value=="edit"?"\u4FEE\u6539":"\u65B0\u589E"),1)]),_:1})]),default:i(()=>[o(ee,{"native-scrollbar":!1,style:B({height:D(z)})},{default:i(()=>[o(h,{justify:"center"},{default:i(()=>[o(m,{class:"px-4 pt-4",formRef:O.value,"onUpdate:formRef":e[2]||(e[2]=r=>O.value=r),formRules:J.value,formOption:fe.value,formLabelWidth:200,itemStyle:{width:"500px"},modelValue:a.value,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value=r),span:24},null,8,["formRef","formRules","formOption","modelValue"])]),_:1})]),_:1},8,["style"]),o(h,{class:"mt-3",justify:"center"},{default:i(()=>[o(E,{type:"save",onClick:ve},{default:i(()=>[C(te(u.value=="edit"?"\u5132\u5B58":"\u65B0\u589E"),1)]),_:1})]),_:1})]),_:1},8,["show","style"]),o(V,{show:R.value,"onUpdate:show":e[7]||(e[7]=r=>R.value=r),preset:"card",class:"p-modal-body p-border",style:B({height:t.cardHeight})},{header:i(()=>[o(h,{class:"p-cardTitle"},{default:i(()=>[Le]),_:1})]),default:i(()=>[o(ee,{"native-scrollbar":!1,style:B({height:D(z)})},{default:i(()=>[o(h,{justify:"center"},{default:i(()=>[o(m,{class:"mt-4 px-4 pt-4",formRef:W.value,"onUpdate:formRef":e[5]||(e[5]=r=>W.value=r),formRules:X.value,formOption:me.value,formLabelWidth:150,itemStyle:{width:"500px"},modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=r=>g.value=r),span:24},null,8,["formRef","formRules","formOption","modelValue"])]),_:1})]),_:1},8,["style"]),o(h,{class:"mt-3",justify:"center"},{default:i(()=>[o(E,{type:"save",disabled:!g.value.id,onClick:pe},{default:i(()=>[Ee]),_:1},8,["disabled"]),o(E,{type:"clear",onClick:Y},{default:i(()=>[Be]),_:1})]),_:1})]),_:1},8,["show","style"]),o(V,{show:L.value,"onUpdate:show":e[10]||(e[10]=r=>L.value=r),preset:"dialog",title:"\u532F\u5165Excel",class:"p-modal-body p-border"},{default:i(()=>[Ge("div",Fe,[o(m,{formRef:U.value,"onUpdate:formRef":e[8]||(e[8]=r=>U.value=r),formRules:Z.value,formOption:ge.value,formLabelPlacement:"top",modelValue:G.value,"onUpdate:modelValue":e[9]||(e[9]=r=>G.value=r),span:24},null,8,["formRef","formRules","formOption","modelValue"])]),o(h,{class:"mb-2",justify:"center"},{default:i(()=>[o(E,{type:"save",onClick:ye},{default:i(()=>[Pe]),_:1})]),_:1})]),_:1},8,["show"])],64)}}};export{Ve as default};
