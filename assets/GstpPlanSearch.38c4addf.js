import{s as K,g as ue,w as ie,c as k,r as o,E as pe,a as d,b as re,d as me,f as n,h as s,i as S,e as de,n as V,F as ce,m as b,p as L}from"./index.c91cc030.js";const ve=b(" \u7DB1\u8981\u8A08\u756B\u67E5\u8A62 "),fe={class:"px-5 my-4"},ye=b("\u4E0A\u50B3"),ge=b("\u4E0A\u50B3"),ke=b("\u7DB1\u8981\u8A08\u756B\u8CC7\u8A0A "),Re={__name:"GstpPlanSearch",setup(be){const{globalFieldData:f,api:v,cf:h,cc:N,_:he,formRules:w,naiveUi:Y,fileSaver:A}=K(ue()),{windowInnerHeight:j,isLoading:R}=K(ie()),U=k(()=>j.value*.65+"px"),Q=k(()=>j.value*.5+"px"),y=o(!1),C=o(!1),x=o(!1),i=Y.value.useMessage(),B=o([]),P=o(!1),E=o([{label:"test1",value:"1"},{label:"test2",value:"2"},{label:"test3",value:"3"}]),p=pe({page:1,pageCount:1,pageSize:25,onChange:a=>{y.value=!0,u.value.currentPage=a,q()}}),T=o(null),W={},z=o([]),u=o({currentPage:p.page,totalPage:p.pageCount,pageRows:p.pageSize});z.value=w.value.createFormRules(W,u);const Z=o([{option:"btn",showLabel:!1,span:24,showFeedback:!1,style:{"margin-bottom":"0.75rem"},btnObject:[{name:"\u532F\u5165Excel",type:"excel",onClick:()=>{C.value=!0}},{name:"\u532F\u5165PDF",type:"pdf",onClick:()=>{x.value=!0}}]},{name:"\u5E74\u5EA6",span:3,option:"select",key:"year",filter:!0,optionsList:k(()=>f.value.yearOptions)},{name:"\u7CFB\u7D71\u7DE8\u865F",option:"input",key:"sysno"},{name:"\u7248\u672C",span:3,option:"select",key:"ver",optionsList:E},{name:"\u8A08\u756B\u540D\u7A31",option:"input",span:6,key:"planName"},{option:"btnTip",btnObject:[{name:"\u67E5\u8A62",type:"search",onClick:()=>{y.value=!0,u.value.currentPage=1,q()}},{name:"\u6E05\u7A7A",type:"clear",onClick:()=>{u.value.year="",u.value.sysno="",u.value.ver="",u.value.planName="",u.value.currentPage=1}}]}]),q=()=>{v.value.queryMainplan(u.value).then(a=>{a.status==200?(i.success("\u67E5\u8A62\u6210\u529F"),B.value=a.data.lists,p.page=a.data.currentPage,p.pageCount=a.data.totalPage,p.itemCount=a.data.totalRows):i.error("\u67E5\u8A62\u5931\u6557"),y.value=!1})},r=o({1:"\u6211\u662F\u6E2C\u8A66\u8CC7\u65990001"}),$=o([{name:"\u7CFB\u7D71\u7DE8\u865F",option:"",key:"sysno"},{name:"\u8A08\u756B\u540D\u7A31\u526F\u6A19\u984C",option:"",key:"plansubName"},{name:"\u8A08\u756B\u5B8C\u6574\u4E2D\u6587\u540D\u7A31",option:"",key:"planName"},{name:"\u5BE9\u8B70\u7DE8\u865F",option:"",key:"reviewNum"},{name:"\u5E74\u5EA6",option:"",key:"year"},{name:"\u90E8\u6703",option:"",key:"ministryCode"},{name:"\u7FA4\u7D44",option:"",key:"mainplancateCode"},{name:"\u7FA4\u7D44\u6BD4\u91CD",option:"",key:"mainplancateProportion"},{name:"\u8A08\u756B\u985E\u5225",option:"",key:"mainplanCode"},{name:"\u9810\u5B9A\u57F7\u884C\u6A5F\u95DC",option:"",key:"preRunImplement"},{name:"\u57F7\u884C\u671F\u9593(\u8D77)",option:"",key:"execStartDate"},{name:"\u57F7\u884C\u671F\u9593(\u8FC4)",option:"",key:"execEndDate"},{name:"\u5168\u7A0B\u671F\u9593(\u8D77)",option:"",key:"allStartDate"},{name:"\u5168\u7A0B\u671F\u9593(\u8FC4)",option:"",key:"allEndDate"},{name:"\u4E2D\u6587\u95DC\u9375\u8A5E",option:"",key:"chtKeyword"},{name:"\u82F1\u6587\u95DC\u9375\u8A5E",option:"",key:"engKeyword"},{name:"\u672C\u8A08\u756B\u5728\u65BD\u653F\u9805\u76EE\u4E4B\u5B9A\u4F4D\u53CA\u529F\u80FD",option:"",key:"govProjectDesc"},{name:"\u4E2D\u7A0B\u65BD\u653F\u8A08\u756B\u95DC\u9375\u7B56\u7565\u76EE\u6A19",option:"",key:"midGovProjectDesc"},{name:"\u8A08\u5283\u6458\u8981",option:"",key:"projectDesc"},{name:"\u9810\u671F\u6548\u76CA",option:"",key:"expectBenfit"},{name:"\u8FD1\u4E09\u5E74\u4E3B\u8981\u7E3E\u6548",option:"",key:"performanceBythree"},{name:"\u524D\u77BB\u57FA\u790E\u5EFA\u8A2D",option:"",key:"frontInfrast"},{name:"\u5168\u7A0B\u8CC7\u6E90\u6295\u5165-\u7B2C1\u5E74",option:"",key:"allresourceStep1"},{name:"\u5168\u7A0B\u8CC7\u6E90\u6295\u5165-\u7B2C2\u5E74",option:"",key:"allresourceStep2"},{name:"\u5168\u7A0B\u8CC7\u6E90\u6295\u5165-\u7B2C3\u5E74",option:"",key:"allresourceStep3"},{name:"\u5168\u7A0B\u8CC7\u6E90\u6295\u5165-\u7B2C4\u5E74",option:"",key:"allresourceStep4"},{name:"\u65B0\u5236\u984D\u5EA6\u985E\u5225",option:"",key:"newQuotaCate"},{name:"\u6230\u7565\u6838\u5FC3/\u91CD\u9EDE\u653F\u7B56/\u4E3B\u8EF8/\u524D\u77BB\u9805\u76EE",option:"",key:"strategic"},{name:"\u91CD\u9EDE\u653F\u7B56\u9805\u76EE",option:"",key:"keyProjDesc"},{name:"\u4E3B\u8EF8\u9805\u76EE",option:"",key:"masterProjDesc"},{name:"\u6230\u7565\u6838\u5FC3\u9805\u76EE",option:"",key:"warProjDesc"},{name:"\u524D\u77BB\u9805\u76EE",option:"",key:"frontProjDesc"}]),_=o({}),J={ver:"req",year:"req",uploadFile:"req"},M=o([]),c=o({year:"",ver:"",uploadFile:[]});M.value=w.value.createFormRules(J,c);const X=k(()=>{const a=new Date().getFullYear()-1911;let e=a-5,l=a+5,m=[];for(l;l>=e;l--)m.push({label:String(l),value:String(l)});return m}),ee=o([{name:"\u5E74\u5EA6",option:"select",key:"year",optionsList:X.value},{name:"\u7248\u672C",option:"select",key:"ver",optionsList:E},{name:"\u4E0A\u50B3\u6A94\u6848",option:"upload",key:"uploadFile",inputFileType:["zip"],span:24}]),ae=()=>{var a;(a=_.value)==null||a.validate(e=>{R.value=!0,e||v.value.uploadZip(c.value.uploadFile[0],"mainplan/upload/zip",{year:c.value.year,ver:c.value.ver}).then(l=>{l.status==200?i.success("\u4E0A\u50B3\u6210\u529F"):i.error("\u4E0A\u50B3\u5931\u6557")})})},F=o({}),oe={uploadFile:"req"},I=o([]),g=o({uploadFile:[]});I.value=w.value.createFormRules(oe,g);const te=o([{name:"\u4E0A\u50B3\u6A94\u6848",option:"upload",key:"uploadFile",inputFileType:["xlsx"]}]),ne=()=>{var a;(a=F.value)==null||a.validate(e=>{e||(R.value=!0,v.value.uploadExcel(g.value.uploadFile[0],"/mainplan/upload/xlsx").then(l=>{l.status==200?i.success("\u4E0A\u50B3\u6210\u529F"):i.error("\u4E0A\u50B3\u5931\u6557")}))})},le=o([{width:"6%",title:"No",key:"id",className:"big-size",render:(a,e)=>`${e+1+(p.page-1)*p.pageSize}`},{title:"\u5E74\u5EA6",width:"8%",key:"year"},{title:"\u7CFB\u7D71\u7DE8\u865F",width:"15%",key:"sysno"},{title:"\u8A08\u756B\u4E2D\u6587\u540D\u7A31",key:"planName"},{title:"\u7248\u672C",width:"7%",key:"ver",render:a=>a.ver==="1"?"\u7533\u8ACB\u7248":a.ver==="2"?"\u6838\u5B9A\u7248":a.ver==="3"?"\u6CD5\u5B9A\u7248":""},{title:"\u4F5C\u696D",width:"20%",key:"actions",render(a){return[L(N.value.commonBtn,{style:{marginRight:"16px"},type:"information",onClick:()=>{R.value=!0,v.value.getMainplan({id:a.id}).then(e=>{e.status==200?(i.success("\u67E5\u8A62\u6210\u529F"),r.value=e.data[0],r.value.ministryCode=h.value.getCodeData(f.value,"ministryCode",r.value.ministryCode).name,r.value.mainplancateCode=h.value.getCodeData(f.value,"mainplancateCode",r.value.mainplancateCode).cname,r.value.mainplanCode=h.value.getCodeData(f.value,"mainplanCode",r.value.mainplanCode).name,P.value=!0):i.error("\u67E5\u8A62\u5931\u6557")})}},{default:()=>L("span",["\u8CC7\u8A0A"])}),L(N.value.commonBtn,{type:"download",onclick:()=>{v.value.downloadFile("/mainplan/doc",{id:a.id}).then(e=>{if(e.status==200){i.success("\u4E0B\u8F09\u6210\u529F");var l=new Blob([e.data],{type:"application/pdf;"});A.value.saveAs(l,a.planName+".pdf")}else i.error("\u4E0B\u8F09\u5931\u6557")})}},{default:()=>"\u4E0B\u8F09"})]}}]);return(a,e)=>{const l=d("commonTitle"),m=d("commonForm"),se=d("n-data-table"),G=d("commonBtn"),D=d("n-space"),O=d("n-modal"),H=d("n-layout");return re(),me(ce,null,[n(l,null,{default:s(()=>[ve]),_:1}),n(m,{class:"mt-2",formRef:T.value,"onUpdate:formRef":e[0]||(e[0]=t=>T.value=t),formRules:z.value,formOption:Z.value,formLabelPlacement:"top",xGap:16,modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value=t),span:4},null,8,["formRef","formRules","formOption","modelValue"]),n(se,{remote:"",columns:le.value,data:B.value,"single-line":!1,"max-height":S(Q),loading:y.value,pagination:p,"paginate-single-page":!1},null,8,["columns","data","max-height","loading","pagination"]),n(O,{show:C.value,"onUpdate:show":e[4]||(e[4]=t=>C.value=t),preset:"dialog",title:"\u532F\u5165Excel",class:"p-modal-body p-border"},{default:s(()=>[de("div",fe,[n(m,{formRef:F.value,"onUpdate:formRef":e[2]||(e[2]=t=>F.value=t),formRules:I.value,formOption:te.value,formLabelPlacement:"top",modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=t=>g.value=t),span:24},null,8,["formRef","formRules","formOption","modelValue"])]),n(D,{class:"mb-2",justify:"center"},{default:s(()=>[n(G,{type:"save",onClick:ne},{default:s(()=>[ye]),_:1})]),_:1})]),_:1},8,["show"]),n(O,{show:x.value,"onUpdate:show":e[7]||(e[7]=t=>x.value=t),preset:"dialog",title:"\u532F\u5165Pdf",class:"p-modal-body p-border"},{default:s(()=>[n(H,{class:"mt-4","native-scrollbar":!1,style:V({height:S(U)})},{default:s(()=>[n(m,{formRef:_.value,"onUpdate:formRef":e[5]||(e[5]=t=>_.value=t),formRules:M.value,formOption:ee.value,formLabelPlacement:"top",modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=t=>c.value=t),span:13},null,8,["formRef","formRules","formOption","modelValue"])]),_:1},8,["style"]),n(D,{class:"mb-2",justify:"center"},{default:s(()=>[n(G,{type:"save",onClick:ae},{default:s(()=>[ge]),_:1})]),_:1})]),_:1},8,["show"]),n(O,{show:P.value,"onUpdate:show":e[9]||(e[9]=t=>P.value=t),preset:"card",style:V([{width:"65% !important"},{height:a.cardHeight}]),class:"p-modal-body-h p-border"},{header:s(()=>[n(D,{class:"p-cardTitle"},{default:s(()=>[ke]),_:1})]),default:s(()=>[n(H,{"native-scrollbar":!1,style:V({height:S(U)})},{default:s(()=>[n(m,{class:"mt-4 px-4 pt-4",formOption:$.value,formLabelPlacement:"top",xGap:40,formLabelWidth:80,modelValue:r.value,"onUpdate:modelValue":e[8]||(e[8]=t=>r.value=t)},null,8,["formOption","modelValue"])]),_:1},8,["style"])]),_:1},8,["show","style"])],64)}}};export{Re as default};
